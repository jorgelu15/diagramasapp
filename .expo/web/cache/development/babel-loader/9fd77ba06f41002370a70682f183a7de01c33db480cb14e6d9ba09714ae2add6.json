{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { Children, useEffect, useReducer } from 'react';\nimport AuthContext from \"./authContext\";\nimport AuthReducer from \"./authReducer\";\nimport { AUTH_USER, ERROR_REMOVE, ADD_ERROR, NOT_AUTHENTICATED, LOGOUT_USER } from \"../../types/index\";\nimport apiDiagrams from \"../../config/axios\";\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nvar AuthState = function AuthState(props) {\n  var initialState = {\n    usuario: null,\n    errorMessage: \"checking\",\n    token: null,\n    status: 'not-authenticated'\n  };\n  var _useReducer = useReducer(AuthReducer, initialState),\n    _useReducer2 = _slicedToArray(_useReducer, 2),\n    state = _useReducer2[0],\n    dispatch = _useReducer2[1];\n  useEffect(function () {\n    checkToken();\n  }, []);\n  var checkToken = function () {\n    var _ref = _asyncToGenerator(function* () {\n      var token = yield AsyncStorage.getItem('token');\n      if (!token) return dispatch({\n        type: NOT_AUTHENTICATED\n      });\n      var res = yield apiDiagrams.get('/auth/validateToken');\n      if (res !== 200) return dispatch({\n        type: NOT_AUTHENTICATED\n      });\n      yield AsyncStorage.setItem('token', res.data._token);\n      dispatch({\n        type: \"AUTH_USER\",\n        payload: res.data\n      });\n    });\n    return function checkToken() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n  var signIn = function () {\n    var _ref2 = _asyncToGenerator(function* (data) {\n      try {\n        var credentials = {\n          username: data.username,\n          password: data.password\n        };\n        var res = yield apiDiagrams.post(\"/auth/login\", credentials);\n        dispatch({\n          type: AUTH_USER,\n          payload: res.data\n        });\n        yield AsyncStorage.setItem('token', res.data._token);\n      } catch (error) {\n        dispatch({\n          type: ADD_ERROR,\n          payload: {\n            errorMessage: 'La informacion escrita es incorrecta'\n          }\n        });\n      }\n    });\n    return function signIn(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  var logOut = function logOut() {\n    dispatch({\n      type: LOGOUT_USER\n    });\n  };\n  var addError = function addError() {\n    dispatch({\n      type: ADD_ERROR,\n      payload: {\n        errorMessage: 'Faltó por llenar algún campo'\n      }\n    });\n  };\n  var removeError = function removeError() {\n    dispatch({\n      type: ERROR_REMOVE\n    });\n  };\n  return _jsx(AuthContext.Provider, {\n    value: {\n      usuario: state.usuario,\n      errorMessage: state.errorMessage,\n      token: state.token,\n      status: state.status,\n      signIn: signIn,\n      logOut: logOut,\n      addError: addError,\n      removeError: removeError\n    },\n    children: props.children\n  });\n};\nexport default AuthState;","map":{"version":3,"names":["React","Children","useEffect","useReducer","AuthContext","AuthReducer","AUTH_USER","ERROR_REMOVE","ADD_ERROR","NOT_AUTHENTICATED","LOGOUT_USER","apiDiagrams","AsyncStorage","jsx","_jsx","AuthState","props","initialState","usuario","errorMessage","token","status","_useReducer","_useReducer2","_slicedToArray","state","dispatch","checkToken","_ref","_asyncToGenerator","getItem","type","res","get","setItem","data","_token","payload","apply","arguments","signIn","_ref2","credentials","username","password","post","error","_x","logOut","addError","removeError","Provider","value","children"],"sources":["C:/Users/Jorge/Escritorio/repositorios/diagramsApp/context/auth/authState.js"],"sourcesContent":["import React, { Children, useEffect, useReducer } from 'react';\r\nimport AuthContext from './authContext';\r\nimport AuthReducer from './authReducer';\r\n\r\nimport {\r\n    AUTH_USER,\r\n    ERROR_REMOVE,\r\n    ADD_ERROR,\r\n    NOT_AUTHENTICATED,\r\n    LOGOUT_USER\r\n} from '../../types/index'\r\nimport apiDiagrams from '../../config/axios';\r\nimport AsyncStorage from '@react-native-async-storage/async-storage';\r\n\r\nconst AuthState = props => {\r\n\r\n    const initialState = {\r\n        usuario: null,\r\n        errorMessage: \"checking\",\r\n        token: null,\r\n        status: 'not-authenticated'\r\n    }\r\n\r\n    const [state, dispatch] = useReducer(AuthReducer, initialState);\r\n     useEffect(()=> {\r\n        checkToken();\r\n     }, [])\r\n\r\n\r\n    const checkToken = async () =>  {\r\n        const token = await AsyncStorage.getItem('token');\r\n        if (!token) return dispatch({ type: NOT_AUTHENTICATED });\r\n\r\n        const res = await apiDiagrams.get('/auth/validateToken');\r\n\r\n        if(res !== 200) return dispatch({type: NOT_AUTHENTICATED})\r\n\r\n        await AsyncStorage.setItem('token', res.data._token);\r\n\r\n        dispatch({\r\n            type: \"AUTH_USER\",\r\n            payload: res.data\r\n        })\r\n    }\r\n\r\n    const signIn = async (data) => {\r\n        try {\r\n            const credentials = {\r\n                username: data.username,\r\n                password: data.password\r\n            }   \r\n            const res = await apiDiagrams.post(\"/auth/login\", credentials);\r\n\r\n            dispatch({\r\n            type: AUTH_USER,\r\n            payload: res.data\r\n            });\r\n            await AsyncStorage.setItem('token', res.data._token);\r\n         }catch (error) {\r\n            dispatch({\r\n                type: ADD_ERROR,\r\n                payload: {\r\n                    errorMessage: 'La informacion escrita es incorrecta'\r\n                }\r\n            })\r\n        }\r\n    }\r\n\r\n    const logOut = () => {\r\n        dispatch({\r\n            type: LOGOUT_USER\r\n        })\r\n    }\r\n\r\n    const addError = () => {\r\n        dispatch({\r\n            type: ADD_ERROR,\r\n            payload: {\r\n                errorMessage:'Faltó por llenar algún campo'\r\n            }\r\n        })\r\n    }\r\n\r\n    const removeError = () => {\r\n        dispatch({\r\n            type: ERROR_REMOVE\r\n        })\r\n    }\r\n\r\n    return (\r\n        <AuthContext.Provider\r\n            value={{\r\n                usuario: state.usuario,\r\n                errorMessage: state.errorMessage,\r\n                token: state.token,\r\n                status: state.status,\r\n                signIn,\r\n                logOut,\r\n                addError,\r\n                removeError\r\n            }}\r\n        >\r\n            {props.children}\r\n        </AuthContext.Provider>\r\n    );\r\n}\r\n\r\nexport default AuthState;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}